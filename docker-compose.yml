version: '3'
services:
  gl:
    image: ghcr.io/theryangeary/gl
    build:
      context: .
      dockerfile: gl/Dockerfile
    restart: unless-stopped
    environment:
      - DATABASE_URL=sqlite:/data/grocery.db
      - PORT=3001
    volumes:
      - gl_data:/data
    networks:
      services:
    depends_on:
      nginx:
        condition: service_started

  nginx:
    image: ghcr.io/theryangeary/nginx
    build:
      context: .
      dockerfile: nginx/Dockerfile
    restart: unless-stopped
    volumes:
      - ./nginx/default.conf:/etc/nginx/conf.d/default.conf
    networks:
      cloudflared:
      services:

  cloudflared:
    image: cloudflare/cloudflared:latest
    command: tunnel --no-autoupdate run
    environment:
      - TUNNEL_TOKEN=${CF_TOKEN}
    restart: unless-stopped
    networks:
      cloudflared:

networks:
  services:
  cloudflared:
    name: cloudflared

volumes:
  gl_data:
